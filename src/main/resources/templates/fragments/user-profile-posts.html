<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="postCard(postItem)">
    <div class="card w-full bg-white border border-gray-200 rounded-lg shadow-md mb-4">
        <div class="card-body p-4">

            <!-- User info -->
            <div class="flex items-center mb-3">
                <div class="avatar mr-3">
                    <div class="w-10 h-10 rounded-full overflow-hidden">
                        <img th:src="@{'https://ui-avatars.com/api/?name=' + ${postItem.user.username}}"/>
                    </div>
                </div>
                <div>
                    <a th:href="@{/users/{id}(id=${postItem.user.id})}"
                       th:text="${postItem.user.username}"
                       class="font-semibold text-gray-900 hover:underline"></a>

                    <p class="text-xs text-gray-500"
                       th:text="${#temporals.format(postItem.createdAt, 'dd MMM yyyy HH:mm')}"></p>

                    <!-- this shows (edited) if edited -->
                    <span th:if="${postItem.editedAt != null}"
                          class="text-xs text-gray-400">(edited)</span>
                </div>
            </div>

            <!-- Content -->
            <p class="text-gray-700 text-sm mb-3" th:text="${postItem.content}"></p>

            <!-- Image -->
            <div th:if="${postItem.imagePath != null}" class="mb-3">
                <img th:src="${postItem.imagePath}" class="rounded-lg w-full object-cover max-h-96"/>
            </div>

            <!-- Actions -->
            <div class="border-y py-2 mb-2 flex justify-between items-center">

                <!-- this shows like/unlike -->
                <div th:with="currentUser=${#authentication.principal.attributes['email']}">

                    <form th:unless="${#lists.contains(postItem.likes.![user.email], currentUser)}"
                          th:action="@{'/posts/' + ${postItem.id} + '/likes'}"
                          method="post"
                          style="display:inline">
                        <button type="submit" class="btn btn-ghost btn-sm text-gray-500 hover:text-blue-500 hover:bg-blue-50">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-[1.2em]">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                            </svg>
                            Like
                        </button>
                    </form>

                    <form th:if="${#lists.contains(postItem.likes.![user.email], currentUser)}"
                          th:action="@{'/posts/' + ${postItem.id} + '/likes/unlike'}"
                          method="post"
                          style="display:inline">
                        <button type="submit" class="btn btn-ghost btn-sm text-red-500 hover:bg-red-50">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="red" viewBox="0 0 24 24" stroke-width="2.5" stroke="red" class="size-[1.2em]">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                            </svg>
                            Unlike
                        </button>
                    </form>

                </div>

                <div class="text-xs text-gray-500 flex items-center space-x-3">
                    <span th:text="${#lists.size(postItem.likes)} + ' likes'"></span>
                    <a th:href="@{/posts/{id}(id=${postItem.id})}"
                       th:text="${#lists.size(postItem.comment)} + ' comments'"></a>
                </div>
            </div>
        </div>
    </div>
</th:block>
</html>
