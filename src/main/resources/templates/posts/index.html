<!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org"
          xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5" >
    <head lang="en">
        <meta charset="UTF-8"/>
        <title>Acebook - Posts</title>
        <link rel="stylesheet" href="/main.css" />
    </head>
    <body>

    <h1>Acebook - Posts</h1>

    <div sec:authorize="isAuthenticated()" id="greeting">
        Signed in as <span sec:authentication="principal.attributes['email']"></span>
    </div>

    <section>
        <h2>Create a new post</h2>
        <form th:action="@{/posts}" th:object="${post}" method="post" enctype="multipart/form-data">
            <!-- CSRF token (needed if Spring Security is enabled) -->
<!--            <input type="hidden"-->
<!--                   th:if="${_csrf != null}"-->
<!--                   th:name="${_csrf.parameterName}"-->
<!--                   th:value="${_csrf.token}" />-->

            <div>
                <label for="content">Comment</label><br />
                <textarea id="content"
                          th:field="*{content}"
                          rows="3"
                          cols="50"
                          placeholder="What's on your mind?" required></textarea>
            </div>

            <!--Optional image upload -->
            <div style="margin-top: 0.5rem;">
                <label for="image">Photos (Optional)</label><br />
                <input id="image"
                        type="file"
                        name="image"
                        accept="image/*">

            </div>

            <div style="margin-top: 0.5rem;">
                <button type="submit">Post</button>
            </div>
        </form>
    </section>

    <hr />

    <section>
        <h2>All posts</h2>

        <div th:if="${#lists.isEmpty(posts)}">
            <p>No posts yet. Be the first to post!</p>
        </div>

        <div th:each="postItem : ${posts}">
            <article style="margin-bottom: 1.5rem; border-bottom: 1px solid #ccc; padding-bottom: 1rem;">

                <!-- Show image if present -->
                <div th:if="${postItem.imagePath != null}">
                    <img th:src="${postItem.imagePath}"
                        alt="Post image"
                        style="max-width: 400px; max-height: 400px; display:block; margin-bottom: 0.5rem;" />
                </div>

                <!-- Post content -->
                <p th:text="${postItem.content}">Post content</p>

                <!-- ðŸ‘ Like button + count -->
                <form th:action="@{'/posts/' + ${postItem.id} + '/likes'}"
                      method="post"
                      style="display:inline">

                    <!-- CSRF token (again, for this POST) -->
<!--                    <input type="hidden"-->
<!--                           th:if="${_csrf != null}"-->
<!--                           th:name="${_csrf.parameterName}"-->
<!--                           th:value="${_csrf.token}" />-->

                    <button type="submit">
                        Like
                        (<span th:text="${#lists.size(postItem.likes)}">0</span>)
                    </button>
                </form>

                <form th:action="@{'/posts/' + ${postItem.id} + '/likes/unlike'}"
                      method="post"
                      style="display:inline; margin-left: 0.5rem;">

                    <!--                    <input type="hidden"-->
                    <!--                           th:if="${_csrf != null}"-->
                    <!--                           th:name="${_csrf.parameterName}"-->
                    <!--                           th:value="${_csrf.token}" />-->

                    <button type="submit">Unlike</button>
                </form>
                <a th:href="@{/posts/{id}(id=${postItem.id})}">Show Post</a>
            </article>
        </div>
    </section>

<!--    <ul th:each="post: ${posts}">-->
<!--        <li th:text="${post.content}" />-->
<!--    </ul>-->
    <div class="pagination">
        <a th:href="@{/posts(page=0)}">Page 1</a>
        <a th:href="@{/posts(page=1)}">Page 2</a>
        <a th:href="@{/posts(page=2)}">Page 3</a>
    </div>
    </body>
</html>
