<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5" >
<head lang="en">
    <meta charset="UTF-8"/>
    <title th:text="${user.username}">'s Acebook Profile</title>
    <link rel="stylesheet" href="/main.css" />
</head>
<body>
<h2>This is <span th:text="${user.username}"></span>'s profile page</h2>

<div th:if="${relationship == null and loggedInUser.id != user.id}">
    <form th:action="@{'/users/' + ${user.id} + '/requests/add'}"
          method="post"
          style="display:inline; margin-left: 0.5rem;">
        <button type="submit">Add Friend</button>
    </form>
</div>

<div th:if="${relationship != null}" th:switch="${relationship?.status?.name() ?: ''}">

    <span th:case="'PENDING'">

        <span th:if="${relationship.receiver.id == loggedInUser.id}">
                <form th:action="@{'/users/' + ${relationship.requester.id} + '/requests/accept'}"
                      method="post"
                      style="display:inline; margin-left: 0.5rem;">
                    <button type="submit">Accept Friend Request</button>
                </form>

                <form th:action="@{'/users/' + ${relationship.requester.id} + '/requests/reject'}"
                      method="post"
                      style="display:inline; margin-left: 0.5rem;">
                    <button type="submit">Reject Friend Request</button>
                </form>
        </span>

        <span th:if="${relationship.requester.id == loggedInUser.id}">
            <button style="display:inline; margin-left: 0.5rem;" disabled> Pending Acceptance</button>
        </span>

    </span>

    <span th:case="'ACCEPTED'">
        <button style="display:inline; margin-left: 0.5rem;" disabled>Already Friends</button>
    </span>

    <span th:case="*">
        </span>
</div>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Active?</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td th:text="${user.id}"></td>
        <td th:text="${user.username}"></td>
        <td th:text="${user.enabled}"></td>
    </tr>
    </tbody>
</table>

</body>
</html>
